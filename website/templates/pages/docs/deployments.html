<%inherit file="/base.html"/>

<%block name="content">

  <%include file="menu.html"/>

  <section class="doc">
    <h1>Examples of Deployments</h1>

    <p>Infinit can be set up in a large variety of configurations, creating storage infrastructure with different tradeoffs between reliability, performance of access, cost, etc.</p>

    <p>The following provides some examples of deployments along with the commands you would need to execute on the machines involved in the infrastructure. Hopefully, this will give you enough information to adapt the deployments according to your needs.</p>

    <blockquote class="warning">In order to keep things simple, the examples below follow the same pattern: <strong>Alice</strong> is the user that sets up the storage infrastructure. Alice accesses a volume from her device A while allowing <strong>Bob</strong> and other users to access it from their respective devices: B, C, etc.</blockquote>

    <h2 id="centralized">Centralized (single server)</h2>

    <p>In this configuration, data is stored in a <strong>centralized</strong> location. Since there is a single server involved, the files are <strong>not replicated</strong>. The availability of the infrastructure is thus fully dependent on this single server and cannot be gauranteed. Should the server fail, all the files would be rendered inaccessible to the users; temporarily or permanently depending on the failure. This is referred to as having a <strong>single point of failure</strong>.</p>

    <p>This durability/availability limitation can be avoided by adding more servers. However, you may want to set up such storage infrastructure in a specific case such as to store short-lived non-critical data. Note that such a deployment is similar to what services such as OwnCloud, Pydio or a simple WebDAV service provide.</p>

    <img src="${url('images/schema-deployment-one-server.png')}" alt="Illustration of a centralized infrastructure i.e. a single server without redundancy"><br>

    <p>In order to set up such an infrastructure, please follow the instructions below, taking care to adjust the options according to your needs (storage capacity contributed by the server, names of the network/volumes etc.). Note that for Bob and subsequent users to be able to list/edit the volume's root directory, Alice would need to grant them access to do so through the <em>infinit-acl</em> binary.</p>

    <ul data-tabs class="tabs">
      <li><a data-tab href="#centralized-server" class="active">Server <span>(Alice)</span></a></li>
      <li><a data-tab href="#centralized-client-a">Client A <span>(Alice)</span></a></li>
      <li><a data-tab href="#centralized-client-b-x">Client B → X <span>(Bob)</span></a></li>
    </ul>

    <div data-tabs-content class="data-tabs-content">
      <div data-tabs-pane class="tabs-pane active" id="centralized-server">
<pre><code>$> infinit-storage --create --filesystem --capacity 100GB --name local
$> infinit-network --create --as alice --storage local --kelips --replication-factor 1 --name cluster --push
$> infinit-volume --create --as alice --network cluster --name shared --push

$> infinit-user --fetch --as alice --name bob
$> infinit-passport --create --as alice --network cluster --user bob --push

$> infinit-network --run --as alice --name cluster --async --cache --publish
</code></pre>
      </div>
      <div data-tabs-pane class="tabs-pane" id="centralized-client-a">
<pre><code>$> infinit-network --fetch --as alice
$> infinit-volume --fetch --as alice

$> infinit-network --link --as alice --name cluster

$> infinit-volume --mount --as alice --name shared --async --cache --publish --mountpoint mnt/shared/
</code></pre>
      </div>
      <div data-tabs-pane class="tabs-pane" id="centralized-client-b-x">
<pre><code>$> infinit-user --fetch --as bob --name alice

$> infinit-network --fetch --as bob
$> infinit-volume --fetch --as bob
$> infinit-passport --fetch --as bob

$> infinit-network --link --as bob --name alice/cluster

$> infinit-volume --mount --as bob --name alice/shared --async --cache --publish --mountpoint mnt/shared/
</code></pre>
      </div>
    </div>

    <h2 id="distributed">Distributed (multiple servers)</h2>

    <p>This type of deployment is more reliable than the previous one as it relies on several servers to <strong>distribute the storage load</strong> so as to <strong>tolerate failures</strong>. In many ways, such a deployment is similar to other systems such as: MooseFS, HDFS, XtreemFS and even Dropbox (with the servers reprensenting the underlying object store i.e. Amazon S3). Such systems are designed to scale within the boundaries of a trusted server infrastructure e.g. a controlled data center.</p>

    <p>A major design concern for this type of architecture is ensuring that it is scaled correctly so that there are enough servers to handle client load. If there are not, there will be a <strong>bottleneck</strong> serving the requests. Should one of the servers the fail, the problem would be exacerbated as clients redirect their requests to the other servers. This could lead to a <a href="https://en.wikipedia.org/wiki/Cascading_failure">cascading failure</a>.</p>

    <img src="${url('images/schema-deployment-multi-servers.png')}" alt="Figure illustrating a storage infrastructure composed of a set of servers with redundancy"><br>

    <p>Follow the steps below to set up such an infrastructure. Note that a replication factor of 2 has been chosen but can be adapted according to your needs and the number of servers involved:</p>

    <ul data-tabs class="tabs">
      <li><a data-tab href="#distributed-server-1" class="active">Server 1 <span>(Alice)</span></a></li>
      <li><a data-tab href="#distributed-server-2-n">Server 2 → N <span>(Alice)</span></a></li>
      <li><a data-tab href="#distributed-client-a">Client A <span>(Alice)</span></a></li>
      <li><a data-tab href="#distributed-client-b-x">Client B → X <span>(Bob)</span></a></li>
    </ul>

    <div data-tabs-content class="data-tabs-content">
      <div data-tabs-pane class="tabs-pane active" id="distributed-server-1">
<pre><code>$> infinit-storage --create --filesystem --capacity 20GB --name local
$> infinit-network --create --as alice --storage local --kelips --replication-factor 2 --name cluster --push
$> infinit-volume --create --as alice --network cluster --name shared --push

$> infinit-user --fetch --as alice --name bob
$> infinit-passport --create --as alice --network cluster --user bob --push

$> infinit-network --run --as alice --name cluster --async --cache --publish
</code></pre>
      </div>
      <div data-tabs-pane class="tabs-pane" id="distributed-server-2-n">
<pre><code>$> infinit-network --fetch --as alice

$> infinit-storage --create --filesystem --capacity 50GB --name local
$> infinit-network --link --as alice --name cluster --storage local

$> infinit-network --run --as alice --name cluster --async --cache --publish
</code></pre>
      </div>
      <div data-tabs-pane class="tabs-pane" id="distributed-client-a">
<pre><code>$> infinit-network --fetch --as alice
$> infinit-volume --fetch --as alice

$> infinit-network --link --as alice --name cluster

$> infinit-volume --mount --as alice --name shared --async --cache --publish --mountpoint mnt/shared/
</code></pre>
      </div>
      <div data-tabs-pane class="tabs-pane" id="distributed-client-b-x">
<pre><code>$> infinit-user --fetch --as bob --name alice

$> infinit-network --fetch --as bob
$> infinit-volume --fetch --as bob
$> infinit-passport --fetch --as bob

$> infinit-network --link --as bob --name alice/cluster

$> infinit-volume --mount --as bob --name alice/shared --async --cache --publish --mountpoint mnt/shared/
</code></pre>
      </div>
    </div>

    <h2 id="decentralized">Decentralized (all servers)</h2>

    <p>This type of deployment addresses the limitations of the previous ones by distributing the storage load, hence the requests, between a large number of nodes. A large number of storage nodes can be achieved by making use of end-user devices and the unused storage that they have. These devices can serve other clients, effectively spreading the request load.</p>

    <p>As a result, such a <strong>highly-scalable</strong> distributed deployment or decentralized deployment, can support a large number of clients. This approach also removes single points of failure and other bottlenecks. The scalable nature of such a deployment ensures <strong>fault tolerance</strong> as the system automatically detects failing servers and transparently rebalances the impacted blocks so as to maintain the replication factor.</p>

    <p>Take note that the replication factor you define can drastically change the infrastructure's behavior. For instance, should you set the replication factor to equal the number of storage nodes in the network, all the blocks of all the files would be replicated on every machine acting as a server (i.e. contributing storage capacity). Such a configuration would be equivalent to Bitorrent Sync. Even though having all the files on your machine at any time is interesting for accessibility, it also consumes a lot of storage capacity on every user's computer.</p>

    <p>Ideally, a replication factor high enough for all the files to be available even if some of the nodes are turned off without requiring all the computers to store a replica for all the files in the system would be chosen. A higher volatility of the nodes would require a higher factor of replication. Note, however, that the replication factor must never exceeds the number of storage nodes in the storage infrastructure.</p>

    <img src="${url('images/schema-decentralized-s3.png')}" alt="Illustration of a decentralized environment in which storage capacities from several client machines are aggregated into a peer-to-peer storage infrastructure"><br>

    <p>Follow the instructions below to set up such an infrastructure. Of note is that the example below is composed mostly of nodes contributing storage capacity from thier local disk while a machine (server C) contributes storage from both its local disk and a public cloud provider, in this case Amazon S3. In addition, while most devices (A, D ... X) contribute storage and access the volume, some nodes operate as a client or server only (B and C).</p>

    <ul data-tabs class="tabs">
      <li><a data-tab href="#decentralized-node-a" class="active">Client/Server A <span>(Alice)</span></a></li>
      <li><a data-tab href="#decentralized-node-b">Client B <span>(Bob)</span></a></li>
      <li><a data-tab href="#decentralized-node-c">Server C <span>(Charlie)</span></a></li>
      <li><a data-tab href="#decentralized-node-d-x">Client/Server D → X <span>(Dave)</span></a></li>
    </ul>

    <div data-tabs-content class="data-tabs-content">
      <div data-tabs-pane class="tabs-pane active" id="decentralized-node-a">
<pre><code>$> infinit-storage --create --filesystem --capacity 15GB --name local
$> infinit-network --create --as alice --storage local --kelips --replication-factor 3 --name cluster --push
$> infinit-volume --create --as alice --network cluster --name shared --push

$> infinit-user --fetch --as alice --name bob
$> infinit-user --fetch --as alice --name charlie
$> infinit-user --fetch --as alice --name dave

$> infinit-passport --create --as alice --network cluster --user bob --push
$> infinit-passport --create --as alice --network cluster --user charlie --push
$> infinit-passport --create --as alice --network cluster --user dave --push

$> infinit-volume --mount --as alice --name shared --async --cache --publish --mountpoint mnt/shared/
</code></pre>
      </div>
      <div data-tabs-pane class="tabs-pane" id="decentralized-node-b">
<pre><code>$> infinit-user --fetch --as bob --name alice

$> infinit-network --fetch --as bob
$> infinit-volume --fetch --as bob
$> infinit-passport --fetch --as bob

$> infinit-network --link --as bob --name alice/cluster

$> infinit-volume --mount --as bob --name alice/shared --async --cache --publish --mountpoint mnt/shared/
</code></pre>
      </div>
      <div data-tabs-pane class="tabs-pane" id="decentralized-node-c">
<pre><code>$> infinit-user --fetch --as charlie --name alice

$> infinit-network --fetch --as charlie
$> infinit-volume --fetch --as charlie
$> infinit-passport --fetch --as charlie

$> infinit-storage --create --filesystem --capacity 30GB --name local
$> infinit-credentials --add --aws --account aws
Access Key ID: ********
Secret Access Key: ********
$> infinit-storage --create --s3 --account aws --region eu-central-1 --bucket charlie --folder alice.cluster --capacity 100GB --name s3
$> infinit-network --link --as charlie --name alice/cluster --storage local --storage s3

$> infinit-network --run --as charlie --name alice/cluster --async --cache --publish
</code></pre>
      </div>
      <div data-tabs-pane class="tabs-pane" id="decentralized-node-d-x">
<pre><code>$> infinit-user --fetch --as dave --name alice

$> infinit-network --fetch --as dave
$> infinit-volume --fetch --as dave
$> infinit-passport --fetch --as dave

$> infinit-storage --create --filesystem --capacity 50GB --name local
$> infinit-network --link --as dave --name alice/cluster --storage local

$> infinit-volume --mount --as dave --name alice/shared --async --cache --publish --mountpoint mnt/shared/
</code></pre>
      </div>
    </div>
  <section>

</%block>
